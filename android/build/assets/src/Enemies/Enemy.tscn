[gd_scene load_steps=10 format=2]

[ext_resource path="res://assets/3d/models/enemy_a_wired.obj" type="ArrayMesh" id=1]
[ext_resource path="res://src/Enemies/Enemy.gd" type="Script" id=2]
[ext_resource path="res://src/particles/ExplosionEnemy.tscn" type="PackedScene" id=3]
[ext_resource path="res://src/materials/blue_body.tres" type="Material" id=4]

[sub_resource type="Curve" id=1]
bake_resolution = 200
_data = [ Vector2( 0, 1 ), 0.0, -4.63273, 0, 0, Vector2( 0.52549, 0.145455 ), 2.17021, 2.17021, 0, 0, Vector2( 1, 0 ), 0.0, 0.0, 0, 0 ]

[sub_resource type="SpatialMaterial" id=2]
resource_name = "dark"
flags_unshaded = true
params_cull_mode = 2
albedo_color = Color( 0, 0, 0, 1 )

[sub_resource type="GDScript" id=3]
script/source = "extends StaticBody

export var explosion_path:NodePath
onready var explosion:CPUParticles = get_node(explosion_path)

export var ship_mesh_path:NodePath
onready var ship_mesh:MeshInstance = get_node(ship_mesh_path)

export var tween_path:NodePath
onready var tween:Tween = get_node(tween_path)

onready var health = $\"../../\".health_max
onready var laser_res = load(\"res://src/Enemies/LaserEnemy.tscn\")

var down = false
var shoot = false

signal health_out

func _ready():
	pass

func hit(amount:int):
	health -= amount
	if health <= 0 and not down:
		down = true
		$CollisionShape.disabled = down
		emit_signal(\"health_out\", null)
		var duration = explosion.lifetime
		tween.interpolate_property(
			ship_mesh, 
			\"scale\",
			ship_mesh.scale,
			Vector3(.1, .1, .1),
			duration,
			tween.TRANS_SINE,
			tween.EASE_IN_OUT,
			0.0)
		tween.start()
		explosion.emitting = true
		yield(get_tree().create_timer(explosion.lifetime), \"timeout\")
		$\"../../\".queue_free()
	pass

func _shoot_side(left:bool):
	var shot_scene = laser_res.duplicate(true)
	var shot = shot_scene.instance()
	shot.set_as_toplevel(true)
	if left:
		$Nozzle_L.add_child(shot)
	else:
		$Nozzle_R.add_child(shot)
	pass

func _on_AreaShotRange_area_entered(area):
	if $Timer.is_stopped():
		$Timer.start()
	pass

func _on_Timer_timeout():
	_shoot_side(true)
	_shoot_side(false)
	pass

func _on_AreaShotRange_area_exited(area):
	if not $Timer.is_stopped():
		$Timer.stop()
	pass

func release_target():
	var target = get_node(\"LockedTarget\")
	if target != null:
		target.queue_free()
	pass
"

[sub_resource type="BoxShape" id=4]
extents = Vector3( 3.49902, 1.75349, 5.67103 )

[sub_resource type="BoxShape" id=5]
extents = Vector3( 9.5855, 8.10082, 73.6102 )

[node name="Enemy" type="PathFollow"]
transform = Transform( 1, -3.32264e-12, -9.78552e-06, 3.94384e-12, 1, 6.3482e-08, 9.78552e-06, -6.3482e-08, 1, 0, 0, 0 )
offset = 1.0
rotation_mode = 4
loop = false
script = ExtResource( 2 )
curve_movement = SubResource( 1 )

[node name="Explosion" parent="." instance=ExtResource( 3 )]
transform = Transform( 6, 1.39698e-09, 5.60473e-17, -1.39698e-09, 6, 1.11322e-09, -5.57881e-17, -1.11322e-09, 6, 0, 0, 0 )
amount = 12

[node name="Tween" type="Tween" parent="."]

[node name="ShipMesh" type="MeshInstance" parent="."]
transform = Transform( -2.5, 0, -9.73536e-07, 0, 2.5, 0, 9.73536e-07, 0, -2.5, 0, 0, 0 )
mesh = ExtResource( 1 )
material/0 = ExtResource( 4 )
material/1 = SubResource( 2 )

[node name="EnemySBody" type="StaticBody" parent="ShipMesh" groups=[
"Enemy",
]]
transform = Transform( 1, 2.00577e-18, 4.54747e-12, -1.73472e-18, 1, -2.84217e-14, -9.09495e-13, 0, 1, -5.42101e-20, 0.358539, 0 )
collision_layer = 3
script = SubResource( 3 )
explosion_path = NodePath("../../Explosion")
ship_mesh_path = NodePath("../../ShipMesh")
tween_path = NodePath("../../Tween")

[node name="CollisionShape" type="CollisionShape" parent="ShipMesh/EnemySBody"]
transform = Transform( 1, 5.82077e-10, 3.72529e-09, -2.32831e-10, 1, -5.16817e-09, -9.31323e-10, -1.24367e-07, 1, 0, 1.68069, 0 )
shape = SubResource( 4 )

[node name="Nozzle_L" type="Position3D" parent="ShipMesh/EnemySBody"]
transform = Transform( 1, -4.77049e-18, 9.09495e-13, -1.45825e-17, 1, 6.39488e-14, -9.09495e-13, 1.13687e-13, 1, -2.24074, 0.956822, 6.87234 )

[node name="Nozzle_R" type="Position3D" parent="ShipMesh/EnemySBody"]
transform = Transform( 1, -3.30682e-18, 9.09495e-13, -1.37152e-17, 1, 2.13163e-14, -9.09495e-13, 1.06581e-13, 1, 2.20089, 0.975172, 6.87227 )

[node name="Timer" type="Timer" parent="ShipMesh/EnemySBody"]

[node name="AreaShotRange" type="Area" parent="ShipMesh"]
transform = Transform( 1, -1.6263e-19, 9.09495e-13, 8.67362e-19, 1, 7.10543e-15, -9.09495e-13, 0, 1, 0, 0, 0 )
collision_layer = 0
collision_mask = 4

[node name="CollisionShape" type="CollisionShape" parent="ShipMesh/AreaShotRange"]
transform = Transform( 1, -7.53521e-18, 9.09495e-13, -3.63208e-18, 1, 7.81597e-14, -9.09495e-13, 7.10543e-14, 1, -0.128643, 2.06339, 81.539 )
shape = SubResource( 5 )

[node name="Timer" type="Timer" parent="."]
wait_time = 0.6
one_shot = true

[node name="TimerFree" type="Timer" parent="."]
wait_time = 15.0
one_shot = true
autostart = true

[node name="Camera" type="Camera" parent="."]
transform = Transform( -1, 4.44523e-18, -8.74224e-08, -5.42101e-20, 1, 0, 8.74224e-08, 0, -1, -0.00127212, 8.25266e-06, -130 )
far = 1500.0

[connection signal="timeout" from="ShipMesh/EnemySBody/Timer" to="ShipMesh/EnemySBody" method="_on_Timer_timeout"]
[connection signal="area_entered" from="ShipMesh/AreaShotRange" to="ShipMesh/EnemySBody" method="_on_AreaShotRange_area_entered"]
[connection signal="area_exited" from="ShipMesh/AreaShotRange" to="ShipMesh/EnemySBody" method="_on_AreaShotRange_area_exited"]
[connection signal="timeout" from="Timer" to="." method="_on_Timer_timeout"]
[connection signal="timeout" from="TimerFree" to="." method="_on_TimerFree_timeout"]
